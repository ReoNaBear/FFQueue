import{c as S,a as x,h,b as q,r as d,G as k,q as b,s as _,t as e,y as o,v as a,x as r,M as l,N as C,H as w,I,J as B}from"./index-yubK24W7.js";import{Q as $}from"./QSeparator-CHMG5UP3.js";import{Q as j,a as J,b as v}from"./QList-BgvLMqTD.js";import{Q as y}from"./QBadge-s8vLssPl.js";import{Q as O}from"./QCard-DuIvwLcF.js";import{Q as U}from"./QPage-DweZhjcl.js";const z=S({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(m,{slots:u}){const c=x(()=>`q-card__section q-card__section--${m.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>h(m.tag,{class:c.value},q(u.default))}}),D={class:"text-h5 q-mb-md"},E={class:"text-primary"},M={class:"text-subtitle1 q-mb-md"},P={class:"text-accent"},V={class:"text-subtitle1 q-mb-md"},W={class:"text-accent"},A={__name:"UserPage",setup(m){const u=d(null),c=d(0),p=d([]),f=d(0);let s=null;k(()=>{s=new WebSocket("ws://localhost:3000"),s.onopen=()=>{console.log("✅ WebSocket 已連線"),s.send(JSON.stringify({action:"getInitialData"}))},s.onmessage=i=>{const t=JSON.parse(i.data);t.type==="initialData"&&(c.value=t.currentNumber,f.value=t.queueCount,p.value=t.products),t.type==="queueUpdate"&&(f.value=t.queueCount),t.type==="currentNumberUpdate"&&(c.value=t.currentNumber),t.type==="productsUpdate"&&(p.value=t.products),t.type==="joinResult"&&(u.value=t.myNumber)}});function g(){s&&s.readyState===WebSocket.OPEN&&s.send(JSON.stringify({action:"joinQueue",clientId:Q()}))}function Q(){const i="clientId",t=document.cookie.match(new RegExp("(^| )"+i+"=([^;]+)"));if(t)return t[2];const n=`user-${Math.random().toString(36).substr(2,9)}`;return document.cookie=`${i}=${n}; path=/; max-age=${3600*24*365}`,n}return(i,t)=>(_(),b(U,{class:"q-pa-md column items-center justify-start"},{default:e(()=>[o("div",D,[t[0]||(t[0]=r(" 我的號碼: ",-1)),o("span",E,l(u.value||"-"),1)]),o("div",M,[t[1]||(t[1]=r(" 目前號碼: ",-1)),o("span",P,l(c.value),1)]),o("div",V,[t[2]||(t[2]=r(" 目前排隊人數: ",-1)),o("span",W,l(f.value),1)]),a(C,{label:"加入排隊",color:"primary",class:"q-mb-lg",onClick:g,disable:!!u.value},null,8,["disable"]),a(O,{flat:"",bordered:"",class:"full-width"},{default:e(()=>[a(z,null,{default:e(()=>[...t[3]||(t[3]=[o("div",{class:"text-h6"},"商品清單",-1)])]),_:1}),a($),a(j,null,{default:e(()=>[(_(!0),w(I,null,B(p.value,(n,N)=>(_(),b(J,{key:N,clickable:""},{default:e(()=>[a(v,null,{default:e(()=>[r(l(n.name),1)]),_:2},1024),a(v,{side:""},{default:e(()=>[a(y,{color:"primary",class:"q-mr-sm"},{default:e(()=>[r("總數: "+l(n.total),1)]),_:2},1024),a(y,{color:"secondary"},{default:e(()=>[r("已售: "+l(n.sold),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}};export{A as default};
