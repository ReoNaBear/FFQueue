import{o as U,aa as re,a4 as be,ab as Se,g as z,a8 as ie,w as A,ac as He,G as $e,a as p,ad as R,c as we,r as O,m as Be,ae as De,h as k,af as Ie,ag as Re,ah as Qe,X as b,a9 as S,F as Ae,ai as Ue,a6 as ze,T as ae,b as We,aj as je,ak as Ke,al as ue,a3 as Ge}from"./index-CLs5wneD.js";import{r as ce,a as Xe,b as Je}from"./focus-manager-DhdJisJs.js";import{e as Ye,d as Ze,h as et}from"./scroll-D0lbJCuI.js";function tt(e,t,i){let o;function n(){o!==void 0&&(re.remove(o),o=void 0)}return U(()=>{e.value===!0&&n()}),{removeFromHistory:n,addToHistory(){o={condition:()=>i.value===!0,handler:t},re.add(o)}}}function it(){let e=null;const t=z();function i(){e!==null&&(clearTimeout(e),e=null)}return be(i),U(i),{removeTimeout:i,registerTimeout(o,n){i(),Se(t)===!1&&(e=setTimeout(()=>{e=null,o()},n))}}}function ot(){let e;const t=z();function i(){e=void 0}return be(i),U(i),{removeTick:i,registerTick(o){e=o,ie(()=>{e===o&&(Se(t)===!1&&e(),e=void 0)})}}}const nt={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},st=["beforeShow","show","beforeHide","hide"];function lt({showing:e,canShow:t,hideOnRouteChange:i,handleShow:o,handleHide:n,processOnMount:a}){const r=z(),{props:u,emit:c,proxy:h}=r;let m;function v(l){e.value===!0?T(l):g(l)}function g(l){if(u.disable===!0||l?.qAnchorHandled===!0||t!==void 0&&t(l)!==!0)return;const y=u["onUpdate:modelValue"]!==void 0;y===!0&&(c("update:modelValue",!0),m=l,ie(()=>{m===l&&(m=void 0)})),(u.modelValue===null||y===!1)&&N(l)}function N(l){e.value!==!0&&(e.value=!0,c("beforeShow",l),o!==void 0?o(l):c("show",l))}function T(l){if(u.disable===!0)return;const y=u["onUpdate:modelValue"]!==void 0;y===!0&&(c("update:modelValue",!1),m=l,ie(()=>{m===l&&(m=void 0)})),(u.modelValue===null||y===!1)&&L(l)}function L(l){e.value!==!1&&(e.value=!1,c("beforeHide",l),n!==void 0?n(l):c("hide",l))}function x(l){u.disable===!0&&l===!0?u["onUpdate:modelValue"]!==void 0&&c("update:modelValue",!1):l===!0!==e.value&&(l===!0?N:L)(m)}A(()=>u.modelValue,x),i!==void 0&&He(r)===!0&&A(()=>h.$route.fullPath,()=>{i.value===!0&&e.value===!0&&T()}),$e(()=>{x(u.modelValue)});const V={show:g,hide:T,toggle:v};return Object.assign(h,V),V}const rt={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function at(e,t=()=>{},i=()=>{}){return{transitionProps:p(()=>{const o=`q-transition--${e.transitionShow||t()}`,n=`q-transition--${e.transitionHide||i()}`;return{appear:!0,enterFromClass:`${o}-enter-from`,enterActiveClass:`${o}-enter-active`,enterToClass:`${o}-enter-to`,leaveFromClass:`${n}-leave-from`,leaveActiveClass:`${n}-leave-active`,leaveToClass:`${n}-leave-to`}}),transitionStyle:p(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}const Q=[];function Ot(e){return Q.find(t=>t.contentEl!==null&&t.contentEl.contains(e))}function ut(e,t){do{if(e.$options.name==="QMenu"){if(e.hide(t),e.$props.separateClosePopup===!0)return R(e)}else if(e.__qPortal===!0){const i=R(e);return i?.$options.name==="QPopupProxy"?(e.hide(t),i):e}e=R(e)}while(e!=null)}function Lt(e,t,i){for(;i!==0&&e!==void 0&&e!==null;){if(e.__qPortal===!0){if(i--,e.$options.name==="QMenu"){e=ut(e,t);continue}e.hide(t)}e=R(e)}}const ct=we({name:"QPortal",setup(e,{slots:t}){return()=>t.default()}});function dt(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function ft(e,t,i,o){const n=O(!1),a=O(!1);let r=null;const u={},c=dt(e);function h(v){if(v===!0){ce(u),a.value=!0;return}a.value=!1,n.value===!1&&(c===!1&&r===null&&(r=Re(!1,o)),n.value=!0,Q.push(e.proxy),Xe(u))}function m(v){if(a.value=!1,v!==!0)return;ce(u),n.value=!1;const g=Q.indexOf(e.proxy);g!==-1&&Q.splice(g,1),r!==null&&(Qe(r),r=null)}return Be(()=>{m(!0)}),e.proxy.__qPortal=!0,De(e.proxy,"contentEl",()=>t.value),{showPortal:h,hidePortal:m,portalIsActive:n,portalIsAccessible:a,renderPortal:()=>c===!0?i():n.value===!0?[k(Ie,{to:r},k(ct,i))]:void 0}}let F=0,J,Y,M,Z=!1,de,fe,me,w=null;function mt(e){ht(e)&&Ae(e)}function ht(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const t=Ue(e),i=e.shiftKey&&!e.deltaX,o=!i&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),n=i||o?e.deltaY:e.deltaX;for(let a=0;a<t.length;a++){const r=t[a];if(et(r,o))return o?n<0&&r.scrollTop===0?!0:n>0&&r.scrollTop+r.clientHeight===r.scrollHeight:n<0&&r.scrollLeft===0?!0:n>0&&r.scrollLeft+r.clientWidth===r.scrollWidth}return!0}function he(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function B(e){Z!==!0&&(Z=!0,requestAnimationFrame(()=>{Z=!1;const{height:t}=e.target,{clientHeight:i,scrollTop:o}=document.scrollingElement;(M===void 0||t!==window.innerHeight)&&(M=i-t,document.scrollingElement.scrollTop=o),o>M&&(document.scrollingElement.scrollTop-=Math.ceil((o-M)/8))}))}function ve(e){const t=document.body,i=window.visualViewport!==void 0;if(e==="add"){const{overflowY:o,overflowX:n}=window.getComputedStyle(t);J=Ye(window),Y=Ze(window),de=t.style.left,fe=t.style.top,me=window.location.href,t.style.left=`-${J}px`,t.style.top=`-${Y}px`,n!=="hidden"&&(n==="scroll"||t.scrollWidth>window.innerWidth)&&t.classList.add("q-body--force-scrollbar-x"),o!=="hidden"&&(o==="scroll"||t.scrollHeight>window.innerHeight)&&t.classList.add("q-body--force-scrollbar-y"),t.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,b.is.ios===!0&&(i===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",B,S.passiveCapture),window.visualViewport.addEventListener("scroll",B,S.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",he,S.passiveCapture))}b.is.desktop===!0&&b.is.mac===!0&&window[`${e}EventListener`]("wheel",mt,S.notPassive),e==="remove"&&(b.is.ios===!0&&(i===!0?(window.visualViewport.removeEventListener("resize",B,S.passiveCapture),window.visualViewport.removeEventListener("scroll",B,S.passiveCapture)):window.removeEventListener("scroll",he,S.passiveCapture)),t.classList.remove("q-body--prevent-scroll"),t.classList.remove("q-body--force-scrollbar-x"),t.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,t.style.left=de,t.style.top=fe,window.location.href===me&&window.scrollTo(J,Y),M=void 0)}function vt(e){let t="add";if(e===!0){if(F++,w!==null){clearTimeout(w),w=null;return}if(F>1)return}else{if(F===0||(F--,F>0))return;if(t="remove",b.is.ios===!0&&b.is.nativeMobile===!0){w!==null&&clearTimeout(w),w=setTimeout(()=>{ve(t),w=null},100);return}}ve(t)}function gt(){let e;return{preventBodyScroll(t){t!==e&&(e!==void 0||t===!0)&&(e=t,vt(t))}}}const C=[];let _;function yt(e){_=e.keyCode===27}function pt(){_===!0&&(_=!1)}function bt(e){_===!0&&(_=!1,ze(e,27)===!0&&C[C.length-1](e))}function ke(e){window[e]("keydown",yt),window[e]("blur",pt),window[e]("keyup",bt),_=!1}function St(e){b.is.desktop===!0&&(C.push(e),C.length===1&&ke("addEventListener"))}function ge(e){const t=C.indexOf(e);t!==-1&&(C.splice(t,1),C.length===0&&ke("removeEventListener"))}const q=[];function Ce(e){q[q.length-1](e)}function wt(e){b.is.desktop===!0&&(q.push(e),q.length===1&&document.body.addEventListener("focusin",Ce))}function ye(e){const t=q.indexOf(e);t!==-1&&(q.splice(t,1),q.length===0&&document.body.removeEventListener("focusin",Ce))}let D=0;const kt={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},pe={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},Vt=we({name:"QDialog",inheritAttrs:!1,props:{...nt,...rt,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,backdropFilter:String,position:{type:String,default:"standard",validator:e=>["standard","top","bottom","left","right"].includes(e)}},emits:[...st,"shake","click","escapeKey"],setup(e,{slots:t,emit:i,attrs:o}){const n=z(),a=O(null),r=O(!1),u=O(!1);let c=null,h=null,m,v;const g=p(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:N}=gt(),{registerTimeout:T}=it(),{registerTick:L,removeTick:x}=ot(),{transitionProps:V,transitionStyle:l}=at(e,()=>pe[e.position][0],()=>pe[e.position][1]),y=p(()=>l.value+(e.backdropFilter!==void 0?`;backdrop-filter:${e.backdropFilter};-webkit-backdrop-filter:${e.backdropFilter}`:"")),{showPortal:oe,hidePortal:ne,portalIsAccessible:qe,renderPortal:Te}=ft(n,a,Ve,"dialog"),{hide:H}=lt({showing:r,hideOnRouteChange:g,handleShow:Fe,handleHide:Me,processOnMount:!0}),{addToHistory:Ee,removeFromHistory:_e}=tt(r,H,g),Ne=p(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${kt[e.position]}`+(u.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),$=p(()=>r.value===!0&&e.seamless!==!0),xe=p(()=>e.autoClose===!0?{onClick:Oe}:{}),Pe=p(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${$.value===!0?"modal":"seamless"}`,o.class]);A(()=>e.maximized,s=>{r.value===!0&&K(s)}),A($,s=>{N(s),s===!0?(wt(G),St(j)):(ye(G),ge(j))});function Fe(s){Ee(),h=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,K(e.maximized),oe(),u.value=!0,e.noFocus!==!0?(document.activeElement?.blur(),L(P)):x(),T(()=>{if(n.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:f,bottom:E}=document.activeElement.getBoundingClientRect(),{innerHeight:le}=window,X=window.visualViewport!==void 0?window.visualViewport.height:le;f>0&&E>X/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-X,E>=le?1/0:Math.ceil(document.scrollingElement.scrollTop+E-X/2))),document.activeElement.scrollIntoView()}v=!0,a.value.click(),v=!1}oe(!0),u.value=!1,i("show",s)},e.transitionDuration)}function Me(s){x(),_e(),se(!0),u.value=!0,ne(),h!==null&&(((s?.type.indexOf("key")===0?h.closest('[tabindex]:not([tabindex^="-"])'):void 0)||h).focus(),h=null),T(()=>{ne(!0),u.value=!1,i("hide",s)},e.transitionDuration)}function P(s){Je(()=>{let f=a.value;if(f!==null){if(s!==void 0){const E=f.querySelector(s);if(E!==null){E.focus({preventScroll:!0});return}}f.contains(document.activeElement)!==!0&&(f=f.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||f.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||f.querySelector("[autofocus], [data-autofocus]")||f,f.focus({preventScroll:!0}))}})}function W(s){s&&typeof s.focus=="function"?s.focus({preventScroll:!0}):P(),i("shake");const f=a.value;f!==null&&(f.classList.remove("q-animate--scale"),f.classList.add("q-animate--scale"),c!==null&&clearTimeout(c),c=setTimeout(()=>{c=null,a.value!==null&&(f.classList.remove("q-animate--scale"),P())},170))}function j(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&W():(i("escapeKey"),H()))}function se(s){c!==null&&(clearTimeout(c),c=null),(s===!0||r.value===!0)&&(K(!1),e.seamless!==!0&&(N(!1),ye(G),ge(j))),s!==!0&&(h=null)}function K(s){s===!0?m!==!0&&(D<1&&document.body.classList.add("q-body--dialog"),D++,m=!0):m===!0&&(D<2&&document.body.classList.remove("q-body--dialog"),D--,m=!1)}function Oe(s){v!==!0&&(H(s),i("click",s))}function Le(s){e.persistent!==!0&&e.noBackdropDismiss!==!0?H(s):e.noShake!==!0&&W()}function G(s){e.allowFocusOutside!==!0&&qe.value===!0&&je(a.value,s.target)!==!0&&P('[tabindex]:not([tabindex="-1"])')}Object.assign(n.proxy,{focus:P,shake:W,__updateRefocusTarget(s){h=s||null}}),U(se);function Ve(){return k("div",{role:"dialog","aria-modal":$.value===!0?"true":"false",...o,class:Pe.value},[k(ae,{name:"q-transition--fade",appear:!0},()=>$.value===!0?k("div",{class:"q-dialog__backdrop fixed-full",style:y.value,"aria-hidden":"true",tabindex:-1,onClick:Le}):null),k(ae,V.value,()=>r.value===!0?k("div",{ref:a,class:Ne.value,style:l.value,tabindex:-1,...xe.value},We(t.default)):null)])}return Te}});var I,Ct=new Uint8Array(16);function qt(){if(!I&&(I=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!I))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(Ct)}const Tt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Et(e){return typeof e=="string"&&Tt.test(e)}var d=[];for(var ee=0;ee<256;++ee)d.push((ee+256).toString(16).substr(1));function _t(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!Et(i))throw TypeError("Stringified UUID is invalid");return i}function Nt(e,t,i){e=e||{};var o=e.random||(e.rng||qt)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,_t(o)}const xt="ws://localhost:3000",te="mock_backend_data",Ht=Ke("queue",{state:()=>({isConnected:!1,clientId:null,myNumber:null,myCart:{},isSubmitted:!1,currentNumber:1,queueCount:0,products:[],clientSelections:{},ws:null}),getters:{cartTotal:e=>{let t=0;for(const[i,o]of Object.entries(e.myCart)){const n=e.products.find(a=>a.id===i);n&&(t+=n.price*o)}return t},cartCount:e=>Object.values(e.myCart).reduce((t,i)=>t+i,0)},actions:{init(){let e=localStorage.getItem("queue_client_id");e||(e=Nt(),localStorage.setItem("queue_client_id",e)),this.clientId=e,this.debouncedSync=Ge(()=>{this.mockSaveToStorage()},500),console.log("ðŸš§ å•Ÿå‹• Mock æ¨¡å¼ (æœ¬åœ°æ¨¡æ“¬)"),this.initMock()},initReal(){this.ws=new WebSocket(xt),this.ws.onopen=()=>{console.log("WS Connected"),this.isConnected=!0,this.ws.send(JSON.stringify({action:"getInitialData",clientId:this.clientId})),this.ws.send(JSON.stringify({action:"joinQueue",clientId:this.clientId}))},this.ws.onclose=()=>{console.log("WS Disconnected"),this.isConnected=!1,setTimeout(()=>this.initReal(),3e3)},this.ws.onmessage=e=>{const t=JSON.parse(e.data);this.handleServerMessage(t)}},handleServerMessage(e){switch(e.type){case"initialData":this.products=e.products,this.queueCount=e.queueCount,this.currentNumber=e.currentNumber,this.clientSelections=e.clientSelections||{},e.myState&&(this.myNumber=e.myState.myNumber,this.myCart=e.myState.myCart||{},this.isSubmitted=e.myState.isSubmitted);break;case"joinResult":this.myNumber=e.myNumber,Object.keys(e.myCart).length===0&&(this.myCart={},this.isSubmitted=!1);break;case"queueUpdate":this.queueCount=e.queueCount;break;case"productsUpdate":this.products=e.products;break;case"nextUpdate":this.currentNumber=e.current,this.checkNotification();break;case"selectionUpdate":this.clientSelections=e.selections;break}},realSendCart(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({action:"updateCart",clientId:this.clientId,cart:this.myCart}))},initMock(){setTimeout(()=>{this.isConnected=!0,this.mockSyncFromStorage(),this.mockRestoreMyState(),this.products.length===0&&(this.products=[{id:"p1",name:"Aè³ž è¦ªç­†ç°½åæ¿",price:1200,qty:1,limit:1,soldOut:!1},{id:"p2",name:"Bè³ž å£“å…‹åŠ›ç«‹ç‰Œ",price:580,qty:3,limit:1,soldOut:!1},{id:"p3",name:"Cè³ž é™é‡å¾½ç« çµ„",price:150,qty:10,limit:3,soldOut:!1},{id:"p4",name:"Dè³ž éš¨æ©Ÿè²¼ç´™",price:50,qty:50,limit:0,soldOut:!1},{id:"p5",name:"Eè³ž æ„Ÿè¬æ¡æ‰‹",price:0,qty:999,limit:0,soldOut:!1}],this.mockSaveToStorage())},800),window.addEventListener("storage",e=>{e.key===te&&(this.mockSyncFromStorage(),this.checkNotification())})},mockSyncFromStorage(){const e=localStorage.getItem(te);if(e){const t=JSON.parse(e);this.currentNumber=t.currentNumber,this.queueCount=t.queueCount,this.products=t.products,this.clientSelections=t.clientSelections||{}}},mockSaveToStorage(){const e={currentNumber:this.currentNumber,queueCount:this.queueCount,products:this.products,clientSelections:this.clientSelections};localStorage.setItem(te,JSON.stringify(e))},mockRestoreMyState(){const e=sessionStorage.getItem("my_mock_number");e&&(this.myNumber=parseInt(e)),this.myNumber&&this.clientSelections[this.myNumber]&&(this.myCart=this.clientSelections[this.myNumber],this.isSubmitted=!0)},drawNewNumber(){this.mockSyncFromStorage(),this.queueCount++,this.myNumber=this.queueCount,sessionStorage.setItem("my_mock_number",this.myNumber),this.myCart={},this.isSubmitted=!1,this.mockSaveToStorage()},clearMyState(){this.myNumber=null,this.myCart={},this.isSubmitted=!1,sessionStorage.removeItem("my_mock_number")},updateCart(e,t){const o=(this.myCart[e]||0)+t,n=this.products.find(a=>a.id===e);if(!(o<0)&&!(n&&o>n.qty)){if(t>0&&n.limit>0&&o>n.limit){ue.create({message:`æ­¤å•†å“æ¯äººé™è³¼ ${n.limit} ä»½å–”ï¼`,color:"warning",icon:"priority_high",position:"top",timeout:1e3});return}o===0?delete this.myCart[e]:this.myCart[e]=o,this.isSubmitted=!1,this.debouncedSync()}},submitSelection(){this.myNumber&&(this.clientSelections[this.myNumber]={...this.myCart},this.mockSaveToStorage(),this.finishSubmit())},finishSubmit(){this.isSubmitted=!0,ue.create({message:"é é¸æ¸…å–®å·²é€å‡ºï¼",color:"positive",position:"top",timeout:1e3}),this.debouncedSync&&this.debouncedSync()},adminNext(){this.mockSyncFromStorage(),this.currentNumber++,this.mockSaveToStorage()},adminUpdateProducts(e){this.products=e,this.mockSaveToStorage()},adminCheckout(e){this.mockSyncFromStorage(),e.forEach(t=>{const i=this.products.find(o=>o.id===t.id);i&&t.checkoutQty>0&&(i.qty=Math.max(0,i.qty-t.checkoutQty))}),this.mockSaveToStorage()},checkNotification(){if(!this.myNumber)return;this.myNumber-this.currentNumber===0&&Notification.permission==="granted"&&new Notification("ðŸŽ‰ è¼ªåˆ°ä½ å›‰ï¼")}}}),$t=(e,t)=>{const i=e.__vccOpts||e;for(const[o,n]of t)i[o]=n;return i};export{Vt as Q,$t as _,Lt as c,Ot as g,Ht as u};
