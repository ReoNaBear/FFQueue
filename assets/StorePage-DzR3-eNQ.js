import{ak as q,r as c,G as y,q as _,s as b,t as m,y as l,v as u,M as g,L as v,N as V,H as N,I as C,J as Q}from"./index-CLs5wneD.js";import{Q as k}from"./QInput-DtEkRFSm.js";import{Q as U,a as x,b as I}from"./QList-C2n-Tvgt.js";import{Q as P}from"./QCard-BmjMeta9.js";import{Q as W}from"./QPage-8IoPDVGW.js";import"./focus-manager-DhdJisJs.js";const h=q("storeManager",()=>{const i=c(0),t=c(0),s=c([]),e=c(null),r=c("store");function p(a){e.value=new WebSocket(a),e.value.onopen=()=>{console.log("WebSocket 已連線"),e.value.send(JSON.stringify({action:"getInitialData",clientId:r.value}))},e.value.onmessage=n=>{const o=JSON.parse(n.data);switch(o.type){case"queueUpdate":i.value=o.queueCount;break;case"productsUpdate":s.value=o.products;break;case"nextUpdate":t.value=o.current;break;case"initialData":s.value=o.products,i.value=o.queueCount,t.value=o.currentNumber;break}},e.value.onclose=()=>{console.log("WebSocket 已斷線，嘗試重連"),setTimeout(()=>p(a),3e3)}}function f(a){s.value=a,e.value&&e.value.readyState===WebSocket.OPEN&&e.value.send(JSON.stringify({action:"updateProducts",products:a}))}function S(){e.value&&e.value.readyState===WebSocket.OPEN&&e.value.send(JSON.stringify({action:"next"}))}return{queueCount:i,currentNumber:t,products:s,ws:e,clientId:r,connectWebSocket:p,updateProducts:f,nextCustomer:S}}),M={class:"q-pa-md"},O={class:"q-mt-md"},B={class:"q-mt-md"},J={class:"q-mt-md"},H={__name:"StorePage",setup(i){const t=h(),s=t.queueCount,e=t.currentNumber,r=t.products;y(()=>{t.connectWebSocket("ws://localhost:3000")});function p(){t.updateProducts(r)}function f(){t.nextCustomer()}return(S,a)=>(b(),_(W,{padding:""},{default:m(()=>[l("div",M,[u(P,{class:"q-pa-md"},{default:m(()=>[a[1]||(a[1]=l("h3",null,"店家管理頁面",-1)),l("div",O,[l("p",null,"目前排隊人數："+g(v(s)),1),l("p",null,"目前到號："+g(v(e)),1)]),l("div",B,[u(V,{color:"primary",label:"下一位",onClick:f})]),l("div",J,[a[0]||(a[0]=l("h5",null,"商品管理",-1)),u(U,{bordered:""},{default:m(()=>[(b(!0),N(C,null,Q(v(r),(n,o)=>(b(),_(x,{key:o},{default:m(()=>[u(I,null,{default:m(()=>[u(k,{modelValue:n.name,"onUpdate:modelValue":d=>n.name=d,label:"商品名稱",dense:""},null,8,["modelValue","onUpdate:modelValue"]),u(k,{modelValue:n.total,"onUpdate:modelValue":d=>n.total=d,modelModifiers:{number:!0},label:"總數量",dense:"",type:"number"},null,8,["modelValue","onUpdate:modelValue"]),u(k,{modelValue:n.sold,"onUpdate:modelValue":d=>n.sold=d,modelModifiers:{number:!0},label:"已賣出數量",dense:"",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),u(V,{class:"q-mt-md",color:"secondary",label:"更新商品",onClick:p})])]),_:1})])]),_:1}))}};export{H as default};
